# 射箭训练AI模型数据准备指南

## 目录

- [概述](#概述)
- [目录结构](#目录结构)
- [姿态分析数据准备](#姿态分析数据准备)
  - [视频数据要求](#视频数据要求)
  - [标注格式](#姿态数据标注格式)
  - [数据采集建议](#姿态数据采集建议)
- [箭靶检测数据准备](#箭靶检测数据准备)
  - [图像数据要求](#图像数据要求)
  - [标注格式](#箭靶数据标注格式)
  - [数据采集建议](#箭靶数据采集建议)
- [数据预处理](#数据预处理)
- [数据增强](#数据增强)
- [常见问题](#常见问题)

## 概述

本指南详细介绍了射箭训练AI服务的数据准备流程，包括姿态分析和箭靶检测两个核心模型所需的数据格式、采集方法和预处理步骤。高质量的训练数据是构建准确AI模型的基础，请按照本指南准备训练数据。

## 目录结构

首先，创建以下目录结构来组织原始数据：

```
ai-service/
└── data/
    └── raw/
        ├── pose/
        │   ├── videos/             # 姿态分析视频文件
        │   └── pose_annotations.csv # 姿态标注文件
        └── target/
            ├── images/             # 箭靶图像文件
            └── target_annotations.csv # 箭靶标注文件
```

预处理脚本将自动创建 `data/processed` 目录并处理原始数据。

## 姿态分析数据准备

### 视频数据要求

姿态分析模型需要射箭动作的视频数据，具体要求如下：

- **视频格式**：MP4 (H.264编码)
- **分辨率**：至少720p (1280×720)，建议1080p (1920×1080)
- **帧率**：至少30fps
- **时长**：每个视频5-15秒，捕捉完整的射箭动作
- **视角**：侧面视角，确保完整拍摄到运动员全身
- **光线**：充足的照明，避免背光和阴影
- **背景**：尽量简单，减少干扰元素
- **服装**：运动员应穿着合适的服装，避免过于宽松导致姿态难以识别

### 姿态数据标注格式

姿态分析的标注文件 `pose_annotations.csv` 格式如下：

```csv
video_file,category,split
archer_001.mp4,perfect,training
archer_002.mp4,good,training
archer_003.mp4,average,testing
archer_004.mp4,poor,training
archer_005.mp4,incorrect,testing
```

字段说明：
- `video_file`：视频文件名，相对于 `data/raw/pose/videos/` 目录
- `category`：姿态质量分类，可选值：
  - `perfect`：完美姿态
  - `good`：良好姿态
  - `average`：一般姿态
  - `poor`：较差姿态
  - `incorrect`：错误姿态
- `split`：数据集划分，可选值：
  - `training`：训练集
  - `testing`：测试集

### 姿态数据采集建议

为获取高质量的姿态数据，建议：

1. **多样化运动员**：不同性别、年龄、体型和技术水平的运动员
2. **多样化环境**：不同的训练场地、光线条件
3. **平衡类别分布**：每个类别的样本数量应尽量平衡
4. **专业评估**：由专业教练对姿态进行分类和评估
5. **数据划分**：训练集与测试集比例建议为8:2，且确保测试集涵盖所有类别

## 箭靶检测数据准备

### 图像数据要求

箭靶检测模型需要箭靶和箭矢的图像数据，具体要求如下：

- **图像格式**：JPG或PNG
- **分辨率**：建议1080p (1920×1080)或更高
- **拍摄距离**：多种不同距离，从近距离(5米)到标准比赛距离(18米、30米、50米、70米等)
- **角度**：主要为正面视角，也应包含一些小角度偏移的视角
- **光线**：多种光线条件，包括室内、室外、明亮、昏暗等
- **箭矢数量**：包含不同数量箭矢的图像(0-6支箭)
- **箭靶类型**：包含标准比赛靶和训练靶

### 箭靶数据标注格式

箭靶检测的标注文件 `target_annotations.csv` 格式如下：

```csv
image_file,annotations,split
target_001.jpg,"[{\"class\":\"target\",\"bbox\":[100,100,500,500]},{\"class\":\"arrow\",\"bbox\":[250,250,260,260]}]",training
target_002.jpg,"[{\"class\":\"target\",\"bbox\":[120,120,520,520]},{\"class\":\"arrow\",\"bbox\":[300,300,310,310]},{\"class\":\"arrow\",\"bbox\":[350,340,360,350]}]",testing
```

字段说明：
- `image_file`：图像文件名，相对于 `data/raw/target/images/` 目录
- `annotations`：JSON格式的标注数据数组，每个对象包含：
  - `class`：对象类别，可选值为 `target`（箭靶）或 `arrow`（箭矢）
  - `bbox`：边界框坐标，格式为 `[x1,y1,x2,y2]`
    - `x1,y1`：左上角坐标
    - `x2,y2`：右下角坐标
- `split`：数据集划分，可选值：
  - `training`：训练集
  - `testing`：测试集

### 箭靶数据采集建议

为获取高质量的箭靶检测数据，建议：

1. **多样化靶面**：不同磨损程度、不同色彩鲜明度的靶面
2. **多样化箭矢**：不同颜色、不同羽片、不同散布模式的箭矢
3. **图像质量**：确保图像清晰，箭靶和箭矢可见
4. **标注精度**：箭靶边界框应精确包围整个靶面，箭矢边界框应精确包围箭头部分
5. **数据平衡**：确保数据集包含足够多的箭矢实例，平衡不同环数得分的分布

## 数据预处理

数据采集完成后，可以使用 `utils/prepare_data.py` 脚本进行自动预处理：

```bash
cd archery-training/ai-service
python utils/prepare_data.py
```

这个脚本会执行以下操作：

1. **姿态数据处理**：
   - 按类别和数据集划分组织视频文件
   - 验证视频格式和质量
   - 生成处理后的数据集

2. **箭靶数据处理**：
   - 转换标注格式为训练所需格式
   - 按数据集划分组织图像和标注
   - 验证图像和标注的完整性

## 数据增强

如果原始数据量不足，可以考虑使用以下数据增强技术：

### 姿态数据增强

1. **帧提取**：从视频中提取更多关键帧
2. **旋转**：轻微角度旋转（±5°）
3. **缩放**：轻微缩放变化（±10%）
4. **镜像翻转**：对右手射箭者进行水平翻转模拟左手射箭者
5. **亮度调整**：轻微调整亮度和对比度

### 箭靶数据增强

1. **裁剪**：随机裁剪图像的一部分，保留目标对象
2. **旋转**：轻微角度旋转（±15°）
3. **色彩调整**：调整亮度、对比度、饱和度
4. **添加噪声**：添加高斯噪声或椒盐噪声
5. **模糊**：轻微模糊处理模拟焦距变化

数据增强可以通过修改 `utils/prepare_data.py` 脚本实现，或使用专门的数据增强库如 `imgaug` 或 `albumentations`。

## 常见问题

### Q: 需要多少训练数据？

A: 建议的最低数据量：
- 姿态分析：每个类别至少50个视频，总计至少250个视频
- 箭靶检测：至少500张图像，包含至少1000个箭矢实例

### Q: 如何处理视频文件过大的问题？

A: 可以进行以下处理：
- 裁剪视频只保留关键动作部分
- 降低视频分辨率（但不低于720p）
- 使用更高效的编码格式（如H.265）

### Q: 如何确保标注质量？

A: 建议采取以下措施：
- 使用专业标注工具（如LabelImg、CVAT等）
- 由多人交叉验证标注结果
- 开发自动验证脚本检查标注格式和完整性

### Q: 数据集应如何划分？

A: 推荐的划分比例：
- 训练集：80%
- 测试集：20%

确保测试集包含所有类别和各种场景，以全面评估模型性能。 